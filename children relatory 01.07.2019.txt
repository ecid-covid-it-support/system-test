
> system-test@1.0.0 test:children /home/thairam/OCARIoT/Testes/system-test
> mocha --opts test/config/mocha.opts test/users.children.spec.ts



  Routes: users.children
    POST /users/children
      when posting a new child user
        ✓ should return status code 201 and the saved child
      when a duplicate error occurs
        ✓ should return status code 409 and message info about duplicate items
      when the child username was not provided
        ✓ should return status code 400 and message info about missing or invalid parameters
      when the child password was not provided
        ✓ should return status code 400 and message info about missing or invalid parameters
      when the institution of the child was not provided
        ✓ should return status code 400 and message info about missing or invalid parameters
      when the child gender was not provided
        ✓ should return status code 400 and message info about missing or invalid parameters
      when the child age was not provided
        ✓ should return status code 400 and message info about missing or invalid parameters
      when the institution provided does not exists
        ✓ should return status code 400 and message for institution not found
      when the institution id provided was invalid
        ✓ should return status code 400 and message for invalid institution id
      when the child gender provided was invalid
        1) should return status code 400 and message about invalid gender
      when the child age provided was negative
        2) should return status code 400 and message about negative age
      when the child posting a new child user
        ✓ should return status code 403 and info message from insufficient permissions
      when the educator posting a new child user
        ✓ should return status code 403 and info message from insufficient permissions
      when the health professional posting a new child user
        ✓ should return status code 403 and info message from insufficient permissions
      when the family posting a new child user
        ✓ should return status code 403 and info message from insufficient permissions
      when the application posting a new child user
        ✓ should return status code 403 and info message from insufficient permissions
    GET /users/children/:child_id
      when get a unique child in database
        ✓ should return status code 200 and a child
      when get only the ID, username and institution of a unique child in database
        ✓ should return status code 200 and only the ID, username and institution of the child
      when the child is not found
        ✓ should return status code 404 and info message from child not found
      when the child_id is invalid
        ✓ should return status code 400 and message info about invalid id
      when a child gets their personal data from database
        ✓ should return status code 200 and the personal data of the child
      when a educator get a unique child in database
        ✓ should return status code 403 and info message from insufficient permissions
      when a health professional get a unique child in database
        ✓ should return status code 403 and info message from insufficient permissions
      when a family get a unique child in database
        ✓ should return status code 403 and info message from insufficient permissions
      when a application get a unique child in database
        ✓ should return status code 403 and info message from insufficient permissions
      when a child get the personal data of another child from the database
        3) should return status code 403 and info message from insufficient permissions
    GET All /users/children
      when get all children in database
        ✓ should return status code 200 and a list of children
      when get only ID and username of all children in database
        4) should return status code 200 and a list with only ID and username of children
      when get only ID and username and institution of all children in database
        ✓ should return status code 200 and a list with only ID institution and username of children
      when get all children in ascending order by username from database
        5) should return status code 200 and a list of children
      when get all children in descending order by age from database
        ✓ should return status code 200 and a list of children
      when get only the two most recent children in database
        ✓ should return status code 200 and a list of children
      when a child get all children in database
        ✓ should return status code 403 and info message from insufficient permissions
      when a educator get all children in database
        ✓ should return status code 403 and info message from insufficient permissions
      when a health professional get all children in database
        ✓ should return status code 403 and info message from insufficient permissions
      when a family get all children in database
        ✓ should return status code 403 and info message from insufficient permissions
      when a application get all children in database
        ✓ should return status code 403 and info message from insufficient permissions
      when get all children in database after deleting all of them
        ✓ should return status code 200 and empty list 
    PATCH /users/children/:child_id
      when the update was successful
        ✓ should return status code 200 and updated child
      when a duplication error occurs
        ✓ should return status code 409 and info message from duplicate value
      when update the child gender for invalid gender
        6) should return status code 400 and message about invalid gender
      when update the child age to negative value
        7) should return status code 400 and message about negative age
      when the institution provided does not exists
        ✓ should return status code 400 and message for institution not found
      when the child_id is invalid
        ✓ should return status code 400 and info message from invalid id
      when the child is not found
        ✓ should return status code 404 and info message from child not found
      when the child update yourself
        8) should return status code 403 and info message from insufficient permissions
      when a child update another child
        9) should return status code 403 and info message from insufficient permissions
      when the educator update a child
        ✓ should return status code 403 and info message from insufficient permissions
      when the health professional update a child
        ✓ should return status code 403 and info message from insufficient permissions
      when the family update a child
        ✓ should return status code 403 and info message from insufficient permissions
      when the application update a child
        ✓ should return status code 403 and info message from insufficient permissions
      PATCH /users/:child_id/password
        when the password update was successful
          ✓ should return status code 204 and no content
        when the old password does not match
          ✓ should return status code 400 and info message from old password does not match
        when the old password does not provided
          ✓ should return status code 400 and info message from old password does not provided
        when the new password does not provided
          ✓ should return status code 400 and info message from old password does not provided
        when the child_id is invalid
          ✓ should return status code 400 and info message from invalid id
        when the child is not found
          ✓ should return status code 404 and info message from child not found
        when the child update your password
          10) should return status code 403 and info message from insufficient permissions
        when the educator update the child password
          11) should return status code 403 and info message from insufficient permissions
        when the health professional update the child password
          12) should return status code 403 and info message from insufficient permissions
        when the family update the child password
          13) should return status code 403 and info message from insufficient permissions
        when the application update the child password
          14) should return status code 403 and info message from insufficient permissions
        when a child updates the password of another child
          15) should return status code 403 and info message from insufficient permissions
        when update the child password without authorization
          16) should return status code 401 and info message about unauthorized
    DELETE /users/:child_id
      when the child was successful deleted
        ✓ should return status code 204 and no content for admin user
      when the child is not found
        ✓ should return status code 204 and no content, even user does not exists
      when the child_id is invalid
        ✓ should return status code 400 and message info about invalid id
      when the child delete yourself
        ✓ should return status code 403 and info message from insufficient permissions
      when the educator delete the child
        ✓ should return status code 403 and info message from insufficient permissions
      when the health professional delete the child
        ✓ should return status code 403 and info message from insufficient permissions
      when the family delete the child
        ✓ should return status code 403 and info message from insufficient permissions
      when the application delete the child
        ✓ should return status code 403 and info message from insufficient permissions
      when a child delete another child
        ✓ should return status code 403 and info message from insufficient permissions


  57 passing (7s)
  16 failing

  1) Routes: users.children
       POST /users/children
         when the child gender provided was invalid
           should return status code 400 and message about invalid gender:
     Error: expected 400 "Bad Request", got 201 "Created"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at parser (node_modules/superagent/lib/node/index.js:916:18)
      at IncomingMessage.res.on (node_modules/superagent/lib/node/parsers/json.js:19:7)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  2) Routes: users.children
       POST /users/children
         when the child age provided was negative
           should return status code 400 and message about negative age:
     Error: expected 400 "Bad Request", got 201 "Created"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at parser (node_modules/superagent/lib/node/index.js:916:18)
      at IncomingMessage.res.on (node_modules/superagent/lib/node/parsers/json.js:19:7)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  3) Routes: users.children
       GET /users/children/:child_id
         when a child get the personal data of another child from the database
           should return status code 403 and info message from insufficient permissions:
     Error: expected 403 "Forbidden", got 200 "OK"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at parser (node_modules/superagent/lib/node/index.js:916:18)
      at IncomingMessage.res.on (node_modules/superagent/lib/node/parsers/json.js:19:7)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  4) Routes: users.children
       GET All /users/children
         when get only ID and username of all children in database
           should return status code 200 and a list with only ID and username of children:
     AssertionError: expected { Object (id, username, ...) } to not have property 'institution'
      at supertest_1.default.get.set.set.expect.then.res (test/users.children.spec.ts:731:57)
      at process._tickCallback (internal/process/next_tick.js:103:7)

  5) Routes: users.children
       GET All /users/children
         when get all children in ascending order by username from database
           should return status code 200 and a list of children:

      AssertionError: expected 'Default child' to deeply equal 'another child'
      + expected - actual

      -Default child
      +another child
      
      at supertest_1.default.get.set.set.expect.then.res (test/users.children.spec.ts:789:57)
      at process._tickCallback (internal/process/next_tick.js:103:7)

  6) Routes: users.children
       PATCH /users/children/:child_id
         when update the child gender for invalid gender
           should return status code 400 and message about invalid gender:
     Error: expected 400 "Bad Request", got 200 "OK"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at parser (node_modules/superagent/lib/node/index.js:916:18)
      at IncomingMessage.res.on (node_modules/superagent/lib/node/parsers/json.js:19:7)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  7) Routes: users.children
       PATCH /users/children/:child_id
         when update the child age to negative value
           should return status code 400 and message about negative age:
     Error: expected 400 "Bad Request", got 200 "OK"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at parser (node_modules/superagent/lib/node/index.js:916:18)
      at IncomingMessage.res.on (node_modules/superagent/lib/node/parsers/json.js:19:7)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  8) Routes: users.children
       PATCH /users/children/:child_id
         when the child update yourself
           should return status code 403 and info message from insufficient permissions:
     Error: expected 403 "Forbidden", got 200 "OK"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at parser (node_modules/superagent/lib/node/index.js:916:18)
      at IncomingMessage.res.on (node_modules/superagent/lib/node/parsers/json.js:19:7)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  9) Routes: users.children
       PATCH /users/children/:child_id
         when a child update another child
           should return status code 403 and info message from insufficient permissions:
     Error: expected 403 "Forbidden", got 200 "OK"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at parser (node_modules/superagent/lib/node/index.js:916:18)
      at IncomingMessage.res.on (node_modules/superagent/lib/node/parsers/json.js:19:7)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  10) Routes: users.children
       PATCH /users/children/:child_id
         PATCH /users/:child_id/password
           when the child update your password
             should return status code 403 and info message from insufficient permissions:
     Error: expected 403 "Forbidden", got 204 "No Content"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at IncomingMessage.parser (node_modules/superagent/lib/node/index.js:916:18)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  11) Routes: users.children
       PATCH /users/children/:child_id
         PATCH /users/:child_id/password
           when the educator update the child password
             should return status code 403 and info message from insufficient permissions:
     Error: expected 403 "Forbidden", got 204 "No Content"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at IncomingMessage.parser (node_modules/superagent/lib/node/index.js:916:18)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  12) Routes: users.children
       PATCH /users/children/:child_id
         PATCH /users/:child_id/password
           when the health professional update the child password
             should return status code 403 and info message from insufficient permissions:
     Error: expected 403 "Forbidden", got 204 "No Content"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at IncomingMessage.parser (node_modules/superagent/lib/node/index.js:916:18)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  13) Routes: users.children
       PATCH /users/children/:child_id
         PATCH /users/:child_id/password
           when the family update the child password
             should return status code 403 and info message from insufficient permissions:
     Error: expected 403 "Forbidden", got 204 "No Content"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at IncomingMessage.parser (node_modules/superagent/lib/node/index.js:916:18)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  14) Routes: users.children
       PATCH /users/children/:child_id
         PATCH /users/:child_id/password
           when the application update the child password
             should return status code 403 and info message from insufficient permissions:
     Error: expected 403 "Forbidden", got 204 "No Content"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at IncomingMessage.parser (node_modules/superagent/lib/node/index.js:916:18)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  15) Routes: users.children
       PATCH /users/children/:child_id
         PATCH /users/:child_id/password
           when a child updates the password of another child
             should return status code 403 and info message from insufficient permissions:
     Error: expected 403 "Forbidden", got 204 "No Content"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at IncomingMessage.parser (node_modules/superagent/lib/node/index.js:916:18)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)

  16) Routes: users.children
       PATCH /users/children/:child_id
         PATCH /users/:child_id/password
           when update the child password without authorization
             should return status code 401 and info message about unauthorized:
     Error: expected 401 "Unauthorized", got 204 "No Content"
      at Test._assertStatus (node_modules/supertest/lib/test.js:268:12)
      at Test._assertFunction (node_modules/supertest/lib/test.js:283:11)
      at Test.assert (node_modules/supertest/lib/test.js:173:18)
      at localAssert (node_modules/supertest/lib/test.js:131:12)
      at /home/thairam/OCARIoT/Testes/system-test/node_modules/supertest/lib/test.js:128:5
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:716:12)
      at IncomingMessage.parser (node_modules/superagent/lib/node/index.js:916:18)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:74:11)
      at process._tickCallback (internal/process/next_tick.js:98:9)



