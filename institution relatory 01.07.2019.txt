
> system-test@1.0.0 test:institution /home/thairam/OCARIoT/Testes/system-test
> mocha --opts test/config/mocha.opts test/institution.spec.ts



  Routes: Institution
    POST /institutions
      when posting a new institution
        ✓ should return status code 201 and the saved institution
      when posting a new institution, only with the required parameters
        ✓ should return status code 201 and the saved institution
      when a duplicate error occurs
        ✓ should return status code 409 and info message about duplicate items
      when a validation error occurs, because type was not informed
        ✓ should return status code 400 and info message from invalid or missing parameters
      when a validation error occurs, because name was not informed
        ✓ should return status code 400 and info message from invalid or missing parameters
      when a validation error occurs, because the institution latitude is a text
        ✓ should return status code 400 and info message from invalid or missing parameters
      when not informed the acess token
        ✓ should return the status code 401 and the authentication failure informational message
      when the child create a institution
        ✓ should return status code 403 and info message from insufficient permissions
      when the educator create a institution
        ✓ should return status code 403 and info message from insufficient permissions
      when the health professional create a institution
        ✓ should return status code 403 and info message from insufficient permissions
      when the family create a institution
        ✓ should return status code 403 and info message from insufficient permissions
      when the application create a institution
        ✓ should return status code 403 and info message from insufficient permissions
    GET /institutions/:institution_id
      when get only the ID, name and address of a unique institution in database
        ✓ should return status code 200 and only the ID, name and address of the institution
      when get only the ID, type, latitude and longitude of a unique institution in database
        ✓ should return status code 200 and only the ID, type, latitude and longitude of the institution
      when the institution is not found
        ✓ should return status code 404 and info message from institution not found
      when get a unique institution informing an invalid ID
        ✓ should return status code 400 and info message from invalid ID format
      when a child get a unique institution in database
        ✓ should return status code 200 and a institution
      when a educator get a unique institution in database
        ✓ should return status code 200 and a institution
      when a health professional get a unique institution in database
        ✓ should return status code 200 and a institution
      when a family  get a unique institution in database
        ✓ should return status code 200 and a institution
    GET ALL /institutions/:institution_id
      when want get all institutions in database
        ✓ should return status code 200 and a list of institutions
      when want get all institutions in database in ascending order by name
        1) should return status code 200 and a list of institutions
      when want get all institutions in database in descending order by type
        2) should return status code 200 and a list of institutions
      when want get only the name and ID of all institutions in database
        ✓ should return status code 200 and a list of institutions
      when want get only the name, ID and type of all institutions in database
        ✓ should return status code 200 and a list of institutions
      when want get only the two most recent institutions in database
        ✓ should return status code 200 and a list of institutions
      when a child  get a all institution in database
        ✓ should return status code 403 and info message from insufficient permissions
      when a educator  get a all institution in database
        ✓ should return status code 403 and info message from insufficient permissions
      when a health professional get a all institution in database
        ✓ should return status code 403 and info message from insufficient permissions
      when a family get a all institution in database
        ✓ should return status code 403 and info message from insufficient permissions
      when a application get a all institution in database
        ✓ should return status code 403 and info message from insufficient permissions
      when want get all institutions in database after deleting all of them
        ✓ should return status code 200 and empty list 
    PATCH /institutions/:institution_id
      when the update was successful
        ✓ should return status code 200 and a updated institution
      When updating address, latitude and longitude into institution successfully
        ✓ should return status code 200 and a updated institution
      when a duplication error occurs
        ✓ should return status code 409 and info message from duplicate items
      when the institution_id is invalid
        ✓ should return status code 400 and info message from invalid id
      when the institution is not found
        ✓ should return status code 404 and info message from institution not found
      when a child update the institution
        ✓ should return status code 403 and info message from insufficient permissions
      when a educator update the institution
        ✓ should return status code 200 and updated the institution
      when a health professional update the institution
        ✓ should return status code 200 and updated the institution
      when a family update the institution
        ✓ should return status code 403 and info message from insufficient permissions
      when a application update the institution
        ✓ should return status code 403 and info message from insufficient permissions
    DELETE /institutions/:institution_id
      when the institution was associated with an user
        ✓ should return status code 400 and info message from existent association
      when a child delete a institution
        ✓ should return status code 403 and info message from insufficient permissions
      when a educator delete a institution
        ✓ should return status code 403 and info message from insufficient permissions
      when a health professional delete a institution
        ✓ should return status code 403 and info message from insufficient permissions
      when a family delete a institution
        ✓ should return status code 403 and info message from insufficient permissions
      when a application delete a institution
        ✓ should return status code 403 and info message from insufficient permissions
      when the deletion was successful
        ✓ should return status code 204 and no content
      when the institution_id is invalid
        ✓ should return status code 400 and info message from invalid id
      when the institution is not found
        ✓ should return status code 204 and no content, even the institution was not founded


  49 passing (3s)
  2 failing

  1) Routes: Institution
       GET ALL /institutions/:institution_id
         when want get all institutions in database in ascending order by name
           should return status code 200 and a list of institutions:

      AssertionError: expected 'Default name' to deeply equal 'another name'
      + expected - actual

      -Default name
      +another name
      
      at supertest_1.default.get.set.set.expect.then.res (test/institution.spec.ts:493:53)
      at process._tickCallback (internal/process/next_tick.js:103:7)

  2) Routes: Institution
       GET ALL /institutions/:institution_id
         when want get all institutions in database in descending order by type
           should return status code 200 and a list of institutions:

      AssertionError: expected 'another name' to deeply equal 'Default name'
      + expected - actual

      -another name
      +Default name
      
      at supertest_1.default.get.set.set.expect.then.res (test/institution.spec.ts:512:53)
      at process._tickCallback (internal/process/next_tick.js:103:7)



